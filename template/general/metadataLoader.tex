\begin{luacode}
--[[Require library for Lua library]]
require("lualibs.lua")

function tableMerge(t1, t2)
    for k,v in pairs(t2) do
        if type(v) == "table" then
            if type(t1[k] or false) == "table" then
                tableMerge(t1[k] or {}, t2[k] or {})
            else
                t1[k] = v
            end
        else
            t1[k] = v
        end
    end
    return t1
end

--[[Opens the two metadata file]]
local specificFile = io.open('metadata.json')
local folderFile = io.open('../metadata.json')
local genericFile = io.open('../../metadata.json')

--[[Reads the files]]
local specificJsonString = specificFile:read('*a')
local folderJsonString = folderFile:read('*a')
local generalJsonString = genericFile:read('*a')

--[[Closes the files]]
specificFile.close()
folderFile.close()
genericFile.close()

--[[Convert the Json strings in Lua dictionaries]]
local specificJson =  utilities.json.tolua(specificJsonString)
local folderJson =  utilities.json.tolua(folderJsonString)
local generalJson =  utilities.json.tolua(generalJsonString)

--[[Merge top layer of dictionaries, so that the specific one overrides the generic one.]]

metadata = tableMerge(tableMerge(generalJson, folderJson), specificJson)

\end{luacode}